# 生小病插件 (Illness Plugin)

## 简介

生小病插件是一个为MoFox_Bot设计的娱乐功能插件，模拟麦麦生病状态，通过Prompt组件智能调整AI的回复风格和语气，让Bot的表现更加人性化和真实。

## 功能特性

### 🏥 疾病系统
- **11种疾病类型**：重感冒、轻感冒、扁桃体炎、肠胃炎、皮肤过敏、轻微擦伤、轻微头痛、落枕、脚踝扭伤、鼻血、口腔溃疡
- **智能疾病转换**：重感冒可能转为轻感冒，其他疾病直接康复
- **现实时间计算**：基于真实时间计算疾病持续时间和恢复进度
- **冷却期机制**：康复后有一段冷却时间，期间不会再次生病

### 🎭 智能语气调整
- **Prompt注入**：通过Prompt组件影响AI回复风格，支持KFC/AFC模式
- **症状匹配**：根据具体疾病调整语气和行为表现
- **动态适应**：疾病不同阶段有不同的表现特征
- **多模式支持**：针对私聊（KFC）和群聊（AFC）提供不同的提示词风格

### 💬 用户交互
- **健康检查**：使用 `/health` 命令查看当前健康状态
- **强制康复**：管理员可使用 `/force_recovery` 强制恢复健康
- **强制生病**：管理员可使用 `/force_sick` 手动触发随机疾病（用于测试）
- **状态显示**：清晰的状态信息和时间预估

### ⚙️ 灵活配置
- **生病概率**：可配置每天生病的概率（默认5%）
- **冷却时间**：可配置康复后的冷却时间（默认3天）
- **功能开关**：可独立开关各个功能模块
- **KFC集成**：可配置KFC/AFC模式集成选项

## 安装使用

### 1. 安装插件
将 `illness_plugin` 目录复制到MoFox_Bot的插件目录中。

### 2. 配置文件
插件会自动生成配置文件 `config/plugins/illness_plugin/config.toml`，您可以根据需要修改：

```toml
[probability]
daily_probability = 0.05  # 每天生病概率5%

[recovery]
cool_down_days = 3.0  # 康复后冷却3天

[features]
enable_health_check = true
enable_force_recovery = true
enable_force_sick = true   # 是否启用强制生病命令
verbose_logging = false

[kfc_integration]
enabled = true
mode = "unified"
priority = 100
```

### 3. 使用命令

#### 查看健康状态
```
/health
```
或中文别名：
```
/健康
/身体状态
/生病
```

#### 强制康复（仅管理员）
```
/force_recovery
```
或中文别名：
```
/康复
/恢复健康
```

#### 强制生病（仅管理员，用于测试）
```
/force_sick
```
或中文别名：
```
/生病
/强制生病
```

## 疾病类型和持续时间

| 疾病类型 | 持续时间 | 转换规则 |
|---------|---------|---------|
| 重感冒 | 2天 | 转为轻感冒 |
| 轻感冒 | 2天 | 直接康复 |
| 扁桃体炎/咽炎 | 2天 | 直接康复 |
| 肠胃不适(腹泻) | 1天 | 直接康复 |
| 皮肤过敏/皮疹 | 2天 | 直接康复 |
| 轻微擦伤 | 1天 | 直接康复 |
| 轻微头痛 | 1天 | 直接康复 |
| 落枕 | 1天 | 直接康复 |
| 脚踝扭伤 | 2天 | 直接康复 |
| 鼻血 | 30分钟 | 直接康复 |
| 口腔溃疡 | 2天 | 直接康复 |

## 技术实现

### 核心组件
- **IllnessManager**: 疾病状态管理核心
- **IllnessPrompt**: Prompt注入组件（支持KFC/AFC模式）
- **IllnessStateHandler**: 事件处理器
- **HealthCheckCommand**: 健康检查命令
- **ForceRecoveryCommand**: 强制康复命令
- **ForceSickCommand**: 强制生病命令

### 数据持久化
使用MoFox_Bot的本地存储API保存疾病状态，确保Bot重启后状态不丢失。

### 时间处理
- 基于现实时间计算
- 考虑Bot离线时间跨度
- 智能时间补偿机制

### 提示词注入
- 支持 `s4u_style_prompt`、`normal_style_prompt`、`kfc_main`、`kfc_replyer`、`afc_main`、`afc_replyer` 等注入点
- 根据当前聊天模式自动选择提示词风格
- 可配置详细日志记录用于调试

## 注意事项

1. **娱乐性质**：本插件为娱乐功能，模拟生病状态，请勿过度依赖
2. **概率控制**：合理设置生病概率，避免影响正常使用体验
3. **管理员权限**：强制康复和强制生病命令建议仅管理员使用
4. **数据安全**：疾病状态数据本地存储，不会上传到外部服务

## 更新日志

### v1.1.0
- 新增强制生病命令 (`/force_sick`)
- 修复提示词注入问题，确保KFC/AFC模式正常工作
- 增强日志记录，便于调试
- 优化插件初始化逻辑，提升稳定性

### v1.0.0
- 初始版本发布
- 实现11种疾病类型
- 完整的疾病管理系统
- Prompt注入功能
- 用户交互命令

## 支持与反馈

如有问题或建议，欢迎通过以下方式反馈：
- 提交Issue
- 联系开发者

希望这个插件能为您的MoFox_Bot带来更多乐趣和人性化的体验！
